import { Component, OnInit, Input } from '@angular/core';
import { str2srec, srec2str } from './binary';
import { from } from 'rxjs';
import { map, flatMap, tap } from 'rxjs/operators';

const input = from( `S00D000053616D706C652E6D6F7412
S31508000000001800203D030008010300080B03000840
S3150800001000000000000000000000000000000000D2
S3150800002000000000000000000000000011030008A6
S3150800003000000000000000001B030008250300085C
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000040B2
S30508000050A2
S31508000070BD030008BD030008BD030008BD03000852
S31508000080BD0300080000000000000000BD030008D2
S3150800009000000000BD030008BD030008BD030008FA
S315080000A000000000BD030008BD030008BD030008EA
S315080000B0BD03000800000000BD030008BD030008DA
S315080000C010B5064C2378002B07D1054B002B02D020
S315080000E00000000004100008044B10B5002B03D0D4
S315080000F00349044800E000BF10BDC04600000000E8
S315080001001000002004100008002243088B4274D314
S3150800011003098B425FD3030A8B4244D3030B8B42FA
S3150800012028D3030C8B420DD3FF22090212BA030C03
S315080001308B4202D31212090265D0030B8B4219D3E4
S3150800014000E0090AC30B8B4201D3CB03C01A524104
S31508000150830B8B4201D38B03C01A5241430B8B424C
S3150800016001D34B03C01A5241030B8B4201D30B0335
S31508000170C01A5241C30A8B4201D3CB02C01A52415C
S3150800019001D34B02C01A5241030A8B4201D30B0208
S315080001A0C01A5241CDD2C3098B4201D3CB01C01A22
S315080001B0524183098B4201D38B01C01A524143092C
S315080001C08B4201D34B01C01A524103098B4201D31A
S315080001D00B01C01A5241C3088B4201D3CB00C01A87
S315080001E0524183088B4201D38B00C01A52414308FF
S315080001F08B4201D34B00C01A5241411A00D2014624
S31508000200524110467047FFE701B5002000F006F896
S3150800021002BDC0460029F7D076E770477047C0464A
S3150800022080B500AF00F0CCF800F001F8FEE790B515
S3150800024000F0D8FE3B1D180010231A00002100F00C
S31508000250D1FE21007B1802221A607B180122DA607F
S315080002607B1810221A617B1800225A627B18180024
S3150800027000F0BEF9031E01D000F019F83B1D072255
S315080002801A603B1D00225A603B1D00229A603B1DE6
S315080002900022DA603B1D0021180000F02FFD031E26
S315080002B000AFC046BD4680BD80B582B000AF0F4BCB
S315080002C09A690E4B01210A439A610C4B9B690122DC
S315080002D013407B607B68094BDA69084B8021490526
S315080002E00A43DA61054BDA6980235B0513403B60F4
S315080002F03B68C046BD4602B080BDC04600100240FD
S3150800030080B500AFC046BD4680BD80B500AFFEE7EC
S7050800033DB2`.split('\n'));

import { Pipe, PipeTransform } from '@angular/core';

@Pipe({ name: 'dec2hex' })
export class Dex2HexPipe implements PipeTransform {
  transform( value: number ) {
    return ('00' + value.toString( 16 ).toUpperCase() ).substr(-2);
  }
}


@Component({
  selector: 'hex-byte',
  template: '<span (click)="clicked()" [ngClass]="active ? \'active\' : \'non\'">{{value | dec2hex}}</span>',
  styles: [ 'span { user-select: all; font-family: monospace; margin: 1px 3px; }' ]
})
export class HexByteComponent {
  @Input() value: number;
  
  active: boolean = true;
  constructor() {}
  
  clicked() {
    this.active = !this.active;
  }
}


@Component({
  selector: 'hex-view',
  template: '<hex-byte *ngFor="let byte of data" [value]="byte"></hex-byte>',
  styles: [ 'hex-byte:nth-child(16n):after { content:  "\\A" }', 'hex-byte { white-space:pre }' ]
})
export class HexViewComponent {
  @Input() data: Uint8Array;
  constructor() {
  }
}

@Component({
  selector: 'app-test-view',
  templateUrl: './test-view.component.html',
  styleUrls: ['./test-view.component.scss']
})
export class TestViewComponent implements OnInit {
  binary: Uint8Array;
  constructor() {}
  ngOnInit() {
    input.pipe(
      str2srec(),
      tap( rec => {
        if( rec.blocks.length > 0 ) {
          this.binary = rec.blocks[0].buffer;
        }
        console.log( rec );
      } ),
      srec2str( { outputCount: true, outputStartAddress: true, outputHeader: true, maxData: 16 } ),
    ).subscribe( rec => {
      console.log( rec );
    } );
  }
}
